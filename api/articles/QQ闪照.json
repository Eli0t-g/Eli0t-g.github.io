{"title":"QQ闪照破解（待完结）","uid":"cca552dbfefca5d5c398c58d9b5bb49c","slug":"QQ闪照","date":"2021-10-13T11:02:46.000Z","updated":"2021-10-13T12:12:39.912Z","comments":true,"path":"api/articles/QQ闪照.json","keywords":null,"cover":"https://i.loli.net/2021/10/13/SQzI7OaUjl2bJ83.jpg","content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>和朋友聊天时突发奇想，想尝试一下获取闪照源文件，忙了一个下午还是没有解决（主要是太菜了 /(ㄒoㄒ)/~~ ）</p></blockquote>\n<h1 id=\"原理和思路\"><a href=\"#原理和思路\" class=\"headerlink\" title=\"原理和思路\"></a>原理和思路</h1><p>闪照貌似是一种木马改编而来，但是因为实用性不高可能就被设计成闪照了（盲猜）。闪照的工作原理大概是有一个FLAG_SECURE窗口，如果启用了FLAG_SECURE，那么将不允许用户在此界面截图/录屏。也就是说，不允许截图这个功能是Android系统提供给开发者的。当时间一过，程序就会自动将闪照删除。在此过程中有个很大的弊端，就是在照片还未读取时，照片会存在于缓存之中，很容易被提取出来查看。<img src=\"https://i.loli.net/2021/10/13/94hWsJ3cOzAQvUk.jpg\" alt=\"v2-490e56ae39fb40e269e4b0076e8fcf43_r.jpg\"></p>\n<p>所以在2021年以前的qq，闪照基本上和普通照片没什么区别，只要在缓存中提取到就可以保存起来。但是现在已经被修复了，网上大部分教程已经失效了。（可能某些大佬自己破解了，只是我不知道）。现在的闪照在缓存中提取到改后缀已经没有用了，因为现在的照片已经被加密了（文件头就写着加密二字😒）</p>\n<p>接下来就是讲讲我自己的思路：</p>\n<p>1、首先找到缓冲区文件，路径（Andriod/data/com.tecent.mobileqq/Tencent/MobileQQ/chatpic/chatimg），里面的东西应该和下面差不多（如果找不到可能是没有打开显示隐藏文件。），之后按照时间顺序找到对应的文件。<img src=\"https://i.loli.net/2021/10/13/bcLsOGxe7SrHBPq.jpg\" alt=\"QQ图片20211013192450.jpg\"></p>\n<p>当初找到以后高兴了老半天，结果打开发现被加密了，气的想打人。后面看到一个大佬讲解，发现是des加密（就知道腾讯不会勤快到自己写出算法）他通过TIM2.1.0的apk反编译了一下，发现com.tencent.mobileqq.utils.DESUtil中有几个函数可以加解密闪照图片，发现使用的是javax.crypto加解密。</p>\n<p>这个类大概就是下面这个样子，其中byte[]参数是加解密的key</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Decompiled with CFR 0_123.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.tencent.mobileqq.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.tencent.mobileqq.utils.FileUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.tencent.qphone.base.util.QLog;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.RandomAccessFile;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.UnsupportedEncodingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.security.Key;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.Cipher;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.CipherInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.CipherOutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DESUtil</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">a</span><span class=\"params\">(File var0, File var1_6, <span class=\"keyword\">byte</span>[] var2_8)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//加密</span></span><br><span class=\"line\">        var6_15 = <span class=\"keyword\">new</span> SecretKeySpec(DESUtil.a((<span class=\"keyword\">byte</span>[])var2_8), <span class=\"string\">&quot;DES&quot;</span>);</span><br><span class=\"line\">        var2_8 = Cipher.getInstance(<span class=\"string\">&quot;DES&quot;</span>);</span><br><span class=\"line\">        var2_8.init(<span class=\"number\">1</span>, (Key)var6_15);</span><br><span class=\"line\">        var6_15 = <span class=\"keyword\">new</span> FileInputStream((File)var0);</span><br><span class=\"line\">        var0 = <span class=\"keyword\">new</span> FileOutputStream((File)var1_6);</span><br><span class=\"line\">        var1_6 = <span class=\"keyword\">new</span> CipherInputStream((InputStream)var6_15, (Cipher)var2_8);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            var2_8 = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">1024</span>];</span><br><span class=\"line\">            var0.write(<span class=\"string\">&quot;ENCRYPT:&quot;</span>.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));<span class=\"comment\">//写文件头</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((var3_16 = var1_6.read((<span class=\"keyword\">byte</span>[])var2_8)) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                var0.write((<span class=\"keyword\">byte</span>[])var2_8, <span class=\"number\">0</span>, var3_16);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (Exception var4_11) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//略</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">a</span><span class=\"params\">(String string, String string2)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//带日志的加密函数，里面调用了上面的a(File,File,byte[])</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DESUtil.a(string)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (QLog.isDevelopLevel()) &#123;</span><br><span class=\"line\">                    QLog.d((String)<span class=\"string\">&quot;DESUtil&quot;</span>, (<span class=\"keyword\">int</span>)<span class=\"number\">2</span>, (String)(<span class=\"string\">&quot;encrypt had encrypt,file:&quot;</span> + string));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">long</span> l = System.currentTimeMillis();</span><br><span class=\"line\">                Object object = string + <span class=\"string\">&quot;.tmp&quot;</span>;</span><br><span class=\"line\">                File file = <span class=\"keyword\">new</span> File(string);</span><br><span class=\"line\">                <span class=\"keyword\">long</span> l2 = file.length() / <span class=\"number\">1024</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((object = <span class=\"keyword\">new</span> File((String)object)).exists()) &#123;</span><br><span class=\"line\">                    object.delete();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                DESUtil.a(file, (File)object, string2.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">                FileUtils.a((File)object, (File)file);</span><br><span class=\"line\">                object.delete();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (QLog.isDevelopLevel()) &#123;</span><br><span class=\"line\">                    QLog.d((String)<span class=\"string\">&quot;DESUtil&quot;</span>, (<span class=\"keyword\">int</span>)<span class=\"number\">4</span>, (String)(<span class=\"string\">&quot;DES Encrypt filePath:&quot;</span> + string + <span class=\"string\">&quot;,key:&quot;</span> + string2 + <span class=\"string\">&quot;,costTime:&quot;</span> + (System.currentTimeMillis() - l) + <span class=\"string\">&quot;,fileSize:&quot;</span> + l2 + <span class=\"string\">&quot;KB&quot;</span>));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (UnsupportedEncodingException unsupportedEncodingException) &#123;</span><br><span class=\"line\">            unsupportedEncodingException.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">a</span><span class=\"params\">(String string, String object, String string2)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//还是带日志的加密函数，里面调用了上面的a(File,File,byte[])</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DESUtil.a(string)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (QLog.isDevelopLevel()) &#123;</span><br><span class=\"line\">                    QLog.d((String)<span class=\"string\">&quot;DESUtil&quot;</span>, (<span class=\"keyword\">int</span>)<span class=\"number\">2</span>, (String)(<span class=\"string\">&quot;encrypt had encrypt,file:&quot;</span> + string));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">long</span> l = System.currentTimeMillis();</span><br><span class=\"line\">                File file = <span class=\"keyword\">new</span> File(string);</span><br><span class=\"line\">                <span class=\"keyword\">long</span> l2 = file.length() / <span class=\"number\">1024</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((object = <span class=\"keyword\">new</span> File((String)object)).exists()) &#123;</span><br><span class=\"line\">                    object.delete();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                DESUtil.a(file, (File)object, string2.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">                file.delete();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (QLog.isDevelopLevel()) &#123;</span><br><span class=\"line\">                    QLog.d((String)<span class=\"string\">&quot;DESUtil&quot;</span>, (<span class=\"keyword\">int</span>)<span class=\"number\">4</span>, (String)(<span class=\"string\">&quot;DES Encrypt filePath:&quot;</span> + string + <span class=\"string\">&quot;,key:&quot;</span> + string2 + <span class=\"string\">&quot;,costTime:&quot;</span> + (System.currentTimeMillis() - l) + <span class=\"string\">&quot;,fileSize:&quot;</span> + l2 + <span class=\"string\">&quot;KB&quot;</span>));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (UnsupportedEncodingException unsupportedEncodingException) &#123;</span><br><span class=\"line\">            unsupportedEncodingException.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">a</span><span class=\"params\">(String var0)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//反编译出来的代码比上面的还乱此略，</span></span><br><span class=\"line\">\t<span class=\"comment\">//从QLog写入的内容大致可以看出该函数的作用应该是检查文件是否已经加/解密过</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">byte</span>[] a(<span class=\"keyword\">byte</span>[] arrby) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//保证key数组定长是8？</span></span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] arrby2 = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">8</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (arrby2.length &gt; arrby.length) &#123;</span><br><span class=\"line\">            System.arraycopy(arrby, <span class=\"number\">0</span>, arrby2, <span class=\"number\">0</span>, arrby.length);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> arrby2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.arraycopy(arrby, <span class=\"number\">0</span>, arrby2, <span class=\"number\">0</span>, arrby2.length);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> arrby2;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">b</span><span class=\"params\">(File var0, File var1_5, <span class=\"keyword\">byte</span>[] var2_7)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//解密</span></span><br><span class=\"line\">        var2_7 = <span class=\"keyword\">new</span> SecretKeySpec(DESUtil.a((<span class=\"keyword\">byte</span>[])var2_7), <span class=\"string\">&quot;DES&quot;</span>);</span><br><span class=\"line\">        var6_15 = Cipher.getInstance(<span class=\"string\">&quot;DES&quot;</span>);</span><br><span class=\"line\">        var6_15.init(<span class=\"number\">2</span>, (Key)var2_7);</span><br><span class=\"line\">        var2_7 = <span class=\"keyword\">new</span> RandomAccessFile((File)var0, <span class=\"string\">&quot;r&quot;</span>);</span><br><span class=\"line\">        var2_7.seek(<span class=\"string\">&quot;ENCRYPT:&quot;</span>.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>).length);<span class=\"comment\">//跳过文件头</span></span><br><span class=\"line\">        var0 = <span class=\"keyword\">new</span> CipherOutputStream(<span class=\"keyword\">new</span> FileOutputStream((File)var1_5), var6_15);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            var1_5 = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">1024</span>];</span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((var3_16 = var2_7.read((<span class=\"keyword\">byte</span>[])var1_5)) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                var0.write((<span class=\"keyword\">byte</span>[])var1_5, <span class=\"number\">0</span>, var3_16);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (Exception var4_10) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//略</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">b</span><span class=\"params\">(String string, String string2)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//带日志的解密</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!DESUtil.a(string)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (QLog.isDevelopLevel()) &#123;</span><br><span class=\"line\">                    QLog.d((String)<span class=\"string\">&quot;DESUtil&quot;</span>, (<span class=\"keyword\">int</span>)<span class=\"number\">2</span>, (String)(<span class=\"string\">&quot;decrypt had no encrypt,file:&quot;</span> + string));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">long</span> l = System.currentTimeMillis();</span><br><span class=\"line\">                Object object = string + <span class=\"string\">&quot;.tmp&quot;</span>;</span><br><span class=\"line\">                File file = <span class=\"keyword\">new</span> File(string);</span><br><span class=\"line\">                <span class=\"keyword\">long</span> l2 = file.length() / <span class=\"number\">1024</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((object = <span class=\"keyword\">new</span> File((String)object)).exists()) &#123;</span><br><span class=\"line\">                    object.delete();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                DESUtil.b(file, (File)object, string2.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">                FileUtils.a((File)object, (File)file);</span><br><span class=\"line\">                object.delete();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (QLog.isDevelopLevel()) &#123;</span><br><span class=\"line\">                    QLog.d((String)<span class=\"string\">&quot;DESUtil&quot;</span>, (<span class=\"keyword\">int</span>)<span class=\"number\">4</span>, (String)(<span class=\"string\">&quot;DES Decrypt filePath:&quot;</span> + string + <span class=\"string\">&quot;,key:&quot;</span> + string2 + <span class=\"string\">&quot;,costTime:&quot;</span> + (System.currentTimeMillis() - l) + <span class=\"string\">&quot;,fileSize:&quot;</span> + l2 + <span class=\"string\">&quot;KB&quot;</span>));</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (UnsupportedEncodingException unsupportedEncodingException) &#123;</span><br><span class=\"line\">            unsupportedEncodingException.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我以为胜利在望，我请教了师兄，发现其中几个包得不到，根本破解不了（o(*≧▽≦)ツ┏━┓）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.tencent.mobileqq.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.tencent.mobileqq.utils.FileUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.tencent.qphone.base.util.QLog;</span><br></pre></td></tr></table></figure>\n\n<p>除此之外，还不知道key从何来，大佬也说要么需要处于登录状态用一定方式从服务器得到，要么从本地消息对象的属性中获得，反正哪个都不容易，单靠一个_fp文件就解密出来原文件应该不太现实。所以我就只能放弃了。</p>\n<h1 id=\"破解方法\"><a href=\"#破解方法\" class=\"headerlink\" title=\"破解方法\"></a>破解方法</h1><p>虽然前面说了没解出来，但是不代表不能获得照片啊（￣︶￣）↗　</p>\n<p>提供三种方法：</p>\n<ul>\n<li><p>方法一：利用bug实现，举报好友填写信息时勾选闪照，在举报成功后会显示闪照内容（好友：我tm真的谢谢你），不过我觉得后面腾讯应该会修复。</p>\n</li>\n<li><p>方法二：最简单的，用另一个手机拍照，最实用最靠谱的(～￣▽￣)～</p>\n</li>\n<li><p>方法三：利用模拟机打开qq，在模拟机里面是无法限制主机截图的，下载一个VMOS模拟机后（应用商店有）在里面下载一个qq打开闪照时就可以截图了[]<del>(￣▽￣)</del>*</p>\n</li>\n</ul>\n<p>个人观点：我觉得非必要情况没必要去获得闪照，毕竟别人发闪照就是不想让你保存，所以看看就行了</p>\n","text":" 和朋友聊天时突发奇想，想尝试一下获取闪照源文件，忙了一个下午还是没有解决（主要是太菜了 /(ㄒoㄒ)/~~ ） 原理和思路闪照貌似是一种木马改编而来，但是因为实用性不高可能就被设计成闪照了（盲猜）。闪照的工作原理大概是有一个FLAG_SECURE窗口，如果启用了FLAG_SEC...","link":"","photos":[],"count_time":{"symbolsCount":"8.6k","symbolsTime":"8 mins."},"categories":[],"tags":[{"name":"感想","slug":"感想","count":2,"path":"api/tags/感想.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86%E5%92%8C%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">原理和思路</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">破解方法</span></a></li></ol>","author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"不要等待，时机永远不会恰到好处。","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ctfshow-pwn","uid":"52662f34cef48ec0871eed4c3bef0137","slug":"ctfshow-pwn","date":"2021-10-16T09:55:50.000Z","updated":"2021-10-29T10:54:03.057Z","comments":true,"path":"api/articles/ctfshow-pwn.json","keywords":null,"cover":"https://i.loli.net/2021/10/29/ctwdE4PqChNIpzb.jpg","text":"pwn03将附件拖进IDA中很容易发现存在栈溢出，但是没有后门函数以及system函数，也不能利用系统调用 所以函数地址泄露获得libc版本来获得system函数地址从而获得shell。具体步骤： 泄露 puts地址 获取 libc 版本 获取 system 地址与 /bin/s...","link":"","photos":[],"count_time":{"symbolsCount":"9.6k","symbolsTime":"9 mins."},"categories":[{"name":"刷题","slug":"刷题","count":6,"path":"api/categories/刷题.json"}],"tags":[{"name":"pwn","slug":"pwn","count":6,"path":"api/tags/pwn.json"}],"author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"不要等待，时机永远不会恰到好处。","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}}},"next_post":{"title":"ctfshow-misc","uid":"050531b15fb9d2cd0cab573b50dcfcd8","slug":"ctfshow-misc","date":"2021-10-05T14:43:36.000Z","updated":"2021-10-16T10:01:31.821Z","comments":true,"path":"api/articles/ctfshow-misc.json","keywords":null,"cover":"https://i.loli.net/2021/10/13/nMZwPpxO8NWJRi4.jpg","text":"misc1签到题，打开就有flag misc2打开txt文件出现一堆乱码，丢进winhex发现是png，直接改后缀名即可 misc3bpg文件使用bpgview工具打开，打开后即可获得flag ","link":"","photos":[],"count_time":{"symbolsCount":98,"symbolsTime":"1 mins."},"categories":[{"name":"刷题","slug":"刷题","count":6,"path":"api/categories/刷题.json"}],"tags":[{"name":"misc","slug":"misc","count":3,"path":"api/tags/misc.json"}],"author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"不要等待，时机永远不会恰到好处。","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}}}}